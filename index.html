<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Windsurf Model Selector v9.0 - Kodexalabs Edition">
    <meta property="og:description" content="Smart prompt enhancement for Windsurf IDE - Analyze your task, get optimal model recommendations, and enhance your prompts with AI">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <title>Windsurf Model Selector v9.0 - Kodexalabs Edition</title>
    
    <style>
        /* ========================================
           KODEXALABS ASD TOKENS v3.8.0 - MONOCHROME
           Strict Black/White Design System
        ======================================== */
        
        :root {
            /* === ASD TOKENS - MONOCHROME PALETTE === */
            --background: 0 0% 0%;           /* Pure black #000000 */
            --foreground: 0 0% 100%;         /* Pure white #ffffff */

            --card: 0 0% 7%;                 /* Surface elevated */
            --card-foreground: 0 0% 100%;
 
            --popover: 0 0% 7%;
            --popover-foreground: 0 0% 100%;
 
            --primary: 0 0% 100%;            /* White primary */
            --primary-foreground: 0 0% 0%;   /* Black text on white */
 
            --secondary: 0 0% 12%;           /* Elevated surface */
            --secondary-foreground: 0 0% 100%;
 
            --muted: 0 0% 12%;
            --muted-foreground: 0 0% 60%;    /* #999999 */
 
            --accent: 0 0% 15%;
            --accent-foreground: 0 0% 100%;
 
            --destructive: 0 0% 100%;        /* Inverted for errors */
            --destructive-foreground: 0 0% 0%;

            --border: 0 0% 23%;              /* Monochrome border */
            --input: 0 0% 15%;
            --ring: 0 0% 100%;
 
            --radius: 0.5rem;

            /* === ASD TEXT COLORS === */
            --text-primary: 0 0% 100%;       /* #ffffff */
            --text-secondary: 0 0% 80%;      /* #cccccc */
            --text-muted: 0 0% 60%;          /* #999999 */
            --text-subtle: 0 0% 40%;         /* #666666 */
            
            /* === KODEXALABS SPACING === */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            
            /* === KODEXALABS BORDER RADIUS === */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 9999px;
            
            /* === TRANSITIONS === */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* ========================================
           RESET & BASE STYLES
        ======================================== */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: 'Power Grotesk', 'Inter', ui-sans-serif, system-ui, sans-serif;
            background: hsl(var(--background));
            color: hsl(var(--foreground));
            line-height: 1.5;
            padding: var(--space-4);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ========================================
           KODEXALABS TYPOGRAPHY
        ======================================== */
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Power Grotesk', 'Inter', ui-sans-serif, system-ui, sans-serif;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: hsl(var(--foreground));
        }
        
        h1 {
            font-size: 1.75rem;
            margin-bottom: var(--space-2);
        }
        
        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-3);
        }
        
        h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: var(--space-3);
        }
        
        p {
            color: hsl(var(--text-secondary));
            margin-bottom: var(--space-3);
            font-size: 0.95rem;
        }
        
        /* ========================================
           LAYOUT
        ======================================== */
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        .grid {
            display: grid;
            gap: var(--space-4);
        }
        
        .grid-2 {
            grid-template-columns: 1fr 320px;
            align-items: start;
        }
        
        /* ========================================
           HEADER
        ======================================== */
        
        header {
            text-align: center;
            margin-bottom: var(--space-6);
            padding: var(--space-4) 0;
        }
        
        .subtitle {
            font-size: 0.95rem;
            color: hsl(var(--text-secondary));
            margin-bottom: var(--space-3);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* ========================================
           QUICK PRESETS BAR - HORIZONTAL LAYOUT
        ======================================== */
        
        .presets-bar {
            display: flex;
            gap: var(--space-2);
            margin: var(--space-4) 0;
            padding: var(--space-3);
            background: hsl(var(--secondary));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-md);
            overflow-x: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            border-bottom: 1px solid hsl(var(--border));
            position: relative;
        }
        
        /* Mobile scroll indicators */
        .presets-bar::before,
        .presets-bar::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 20px;
            pointer-events: none;
            z-index: 1;
        }
        
        .presets-bar::before {
            left: 0;
            background: linear-gradient(to right, hsl(var(--secondary)), transparent);
        }
        
        .presets-bar::after {
            right: 0;
            background: linear-gradient(to left, hsl(var(--secondary)), transparent);
        }
        
        .presets-bar .preset-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-3) var(--space-2);
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-md);
            color: hsl(var(--text-primary));
            cursor: pointer;
            transition: all var(--transition-fast);
            min-width: 100px;
            text-align: center;
        }
        
        .presets-bar .preset-btn:hover {
            background: hsl(var(--accent));
            border-color: hsl(var(--foreground));
            transform: translateY(-2px);
        }
        
        .presets-bar .preset-btn.active {
            background: hsl(var(--accent));
            border-color: hsl(var(--foreground));
        }
        
        .presets-bar .preset-icon {
            font-size: 1.2rem;
        }
        
        .presets-bar .preset-name {
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .presets-bar .preset-desc {
            font-size: 0.7rem;
            color: hsl(var(--text-muted));
            line-height: 1.2;
        }
        
        /* ========================================
           COMPONENTS
        ======================================== */
        
        .card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            transition: all var(--transition-base);
        }
        
        .auto-mode-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: hsl(var(--secondary));
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            border: 1px solid hsl(var(--border));
            margin-bottom: var(--space-4);
        }
        
        .auto-mode-title {
            font-weight: 600;
            color: hsl(var(--foreground));
            font-size: 0.95rem;
            margin-bottom: 2px;
        }
        
        .auto-mode-desc {
            font-size: 0.8rem;
            color: hsl(var(--text-secondary));
        }
        
        /* ========================================
           TOGGLE SWITCH - MONOCHROME
        ======================================== */
        
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: hsl(var(--muted));
            transition: .4s;
            border-radius: 24px;
            border: 1px solid hsl(var(--border));
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: hsl(var(--text-muted));
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: hsl(var(--muted));
            border-color: hsl(var(--foreground));
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
            background-color: hsl(var(--foreground));
        }
        
                
        /* ========================================
           INPUT & BUTTONS - MONOCHROME
        ======================================== */
        
        .input-section {
            margin-bottom: var(--space-4);
        }
        
        .input-label {
            display: block;
            font-weight: 500;
            color: hsl(var(--foreground));
            margin-bottom: var(--space-2);
            font-size: 0.9rem;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: var(--space-3);
            background: hsl(var(--input));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-md);
            color: hsl(var(--foreground));
            font-family: inherit;
            font-size: 0.95rem;
            resize: vertical;
            transition: border-color var(--transition-fast);
        }
        
        textarea:focus {
            outline: none;
            border-color: hsl(var(--ring));
            box-shadow: 0 0 0 1px hsl(var(--ring));
        }
        
        .input-hint {
            font-size: 0.8rem;
            color: hsl(var(--text-muted));
            margin-top: var(--space-2);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all var(--transition-base);
            border: 1px solid transparent;
            line-height: 1;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-primary {
            background: hsl(var(--foreground));
            color: hsl(var(--background));
            border: 1px solid hsl(var(--foreground));
        }
        
        .btn-primary:hover {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: hsl(var(--secondary));
            color: hsl(var(--foreground));
            border-color: hsl(var(--border));
        }
        
        .btn-secondary:hover {
            background: hsl(var(--accent));
            border-color: hsl(var(--foreground));
        }
        
        .btn-outline {
            background: transparent;
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--foreground));
        }
        
        .btn-outline:hover {
            background: hsl(var(--foreground));
            color: hsl(var(--background));
        }
        
        /* ========================================
           SIDEBAR RECOMMENDATIONS - MONOCHROME
        ======================================== */
        
        .recommendations-sidebar {
            background: hsl(var(--secondary));
            border-radius: var(--radius-lg);
            border: 1px solid hsl(var(--border));
            padding: var(--space-4);
            height: fit-content;
            position: sticky;
            top: var(--space-4);
        }
        
        .sidebar-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: hsl(var(--text-muted));
            margin-bottom: var(--space-3);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid hsl(var(--border));
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        #compact-cards {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .compact-card {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-md);
            padding: var(--space-3);
            transition: all var(--transition-fast);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .compact-card:hover {
            border-color: hsl(var(--foreground));
            background: hsl(var(--accent));
            transform: translateX(2px);
        }
        
        .compact-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-2);
        }
        
        .compact-rank {
            font-size: 1rem;
            font-weight: 800;
            color: hsl(var(--text-muted));
            background: hsl(var(--secondary));
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
        }
        
        .compact-name {
            font-weight: 600;
            color: hsl(var(--foreground));
            font-size: 0.9rem;
        }
        
        .compact-category {
            font-size: 0.75rem;
            color: hsl(var(--text-muted));
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-2);
        }
        
        .compact-specs {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }
        
        .compact-spec {
            font-size: 0.8rem;
            color: hsl(var(--text-secondary));
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .compact-spec strong {
            color: hsl(var(--foreground));
        }
        
        /* ========================================
           MODEL CATEGORIES - MONOCHROME INDICATORS
        ======================================== */
        
        .category-indicator {
            display: inline-block;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .category-workhorse {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--foreground));
        }
        
        .category-premium {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 2px solid hsl(var(--foreground));
        }
        
        .category-budget {
            background: hsl(var(--secondary));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--border));
        }
        
        .category-free {
            background: hsl(var(--muted));
            color: hsl(var(--text-muted));
            border: 1px solid hsl(var(--border));
        }
        
        .category-planning {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--border));
        }
        
        .category-avoid {
            background: hsl(var(--destructive-foreground));
            color: hsl(var(--destructive));
            border: 1px solid hsl(var(--destructive));
        }
        
        .category-speed {
            background: hsl(var(--accent));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--border));
        }
        
        .category-balanced {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--foreground));
        }
        
        .category-reasoning {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px dashed hsl(var(--foreground));
        }
        
        /* ========================================
           STATUS INDICATORS - MONOCHROME
        ======================================== */
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-success {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--foreground));
        }
        
        .status-warning {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--foreground));
        }
        
        .status-error {
            background: hsl(var(--destructive-foreground));
            color: hsl(var(--destructive));
            border: 1px solid hsl(var(--destructive));
        }
        
        .status-info {
            background: hsl(var(--card));
            color: hsl(var(--foreground));
            border: 1px solid hsl(var(--border));
        }
        
        /* ========================================
           ANALYSIS PROGRESS - ANIMATED UX
        ======================================== */
        
        .analysis-progress {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-base);
        }
        
        .analysis-progress.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        .progress-step {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
            opacity: 0.3;
            transition: all var(--transition-fast);
        }
        
        .progress-step.active {
            opacity: 1;
        }
        
        .progress-step.complete {
            opacity: 1;
        }
        
        .step-checkmark {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid hsl(var(--border));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all var(--transition-fast);
        }
        
        .progress-step.active .step-checkmark {
            border-color: hsl(var(--foreground));
            background: hsl(var(--secondary));
        }
        
        .progress-step.complete .step-checkmark {
            border-color: hsl(var(--foreground));
            background: hsl(var(--foreground));
            color: hsl(var(--background));
            transform: scale(1.1);
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-weight: 600;
            color: hsl(var(--foreground));
            margin-bottom: 2px;
        }
        
        .step-details {
            font-size: 0.8rem;
            color: hsl(var(--text-secondary));
        }
        
        .feature-pills {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-1);
            margin-top: var(--space-2);
        }
        
        .feature-pill {
            background: hsl(var(--accent));
            color: hsl(var(--foreground));
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 500;
            opacity: 0;
            transform: translateX(-10px);
            animation: pillFadeIn 0.3s forwards;
        }
        
        @keyframes pillFadeIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .model-scores {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
            margin-top: var(--space-2);
        }
        
        .model-score {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-1) var(--space-2);
            background: hsl(var(--secondary));
            border-radius: var(--radius-sm);
            opacity: 0;
            transform: translateX(-10px);
            animation: scoreSlideIn 0.4s forwards;
        }
        
        @keyframes scoreSlideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .model-name {
            font-size: 0.8rem;
            color: hsl(var(--foreground));
        }
        
        .score-value {
            font-weight: 600;
            color: hsl(var(--foreground));
        }
        
        .ranking-slots {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-2);
        }
        
        .rank-slot {
            flex: 1;
            padding: var(--space-2);
            background: hsl(var(--secondary));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-sm);
            text-align: center;
            opacity: 0;
            transform: scale(0.9);
            animation: slotPopIn 0.3s forwards;
        }
        
        @keyframes slotPopIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .rank-label {
            font-size: 0.7rem;
            color: hsl(var(--text-muted));
            margin-bottom: 2px;
        }
        
        .rank-model {
            font-weight: 600;
            color: hsl(var(--foreground));
            font-size: 0.8rem;
        }
        
        /* ========================================
           TOAST NOTIFICATIONS
        ======================================== */
        
        .toast {
            position: fixed;
            bottom: var(--space-4);
            right: var(--space-4);
            background: hsl(var(--card));
            border: 1px solid hsl(var(--foreground));
            border-radius: var(--radius-md);
            padding: var(--space-3) var(--space-4);
            color: hsl(var(--foreground));
            font-size: 0.9rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-base);
            z-index: 1000;
            max-width: 300px;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ========================================
           COPY BUTTON & HISTORY
        ======================================== */
        
        .input-wrapper {
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            background: hsl(var(--secondary));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-sm);
            padding: var(--space-1);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 0.8rem;
            color: hsl(var(--text-muted));
        }
        
        .copy-btn:hover {
            background: hsl(var(--accent));
            color: hsl(var(--foreground));
        }
        
        .copy-btn.copied {
            background: hsl(var(--foreground));
            color: hsl(var(--background));
        }
        
        .history-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .history-toggle {
            background: none;
            border: none;
            color: hsl(var(--text-muted));
            cursor: pointer;
            padding: var(--space-1);
            font-size: 0.9rem;
            margin-left: var(--space-2);
        }
        
        .history-toggle:hover {
            color: hsl(var(--foreground));
        }
        
        .history-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-md);
            min-width: 250px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .history-menu.show {
            display: block;
        }
        
        .history-item {
            padding: var(--space-2) var(--space-3);
            cursor: pointer;
            border-bottom: 1px solid hsl(var(--border));
            font-size: 0.8rem;
        }
        
        .history-item:hover {
            background: hsl(var(--secondary));
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-text {
            color: hsl(var(--foreground));
            margin-bottom: 2px;
        }
        
        .history-time {
            color: hsl(var(--text-muted));
            font-size: 0.7rem;
        }
        
        .history-clear {
            padding: var(--space-2) var(--space-3);
            color: hsl(var(--text-muted));
            cursor: pointer;
            font-size: 0.8rem;
            text-align: center;
            border-top: 1px solid hsl(var(--border));
        }
        
        .history-clear:hover {
            color: hsl(var(--foreground));
        }
        
        /* ========================================
           MODEL COMPARISON TABLE
        ======================================== */
        
        .comparison-table {
            margin-top: var(--space-4);
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-base);
        }
        
        .comparison-table.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        .comparison-title {
            font-weight: 600;
            color: hsl(var(--foreground));
            margin-bottom: var(--space-3);
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-3);
        }
        
        .model-card {
            background: hsl(var(--secondary));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius-md);
            padding: var(--space-3);
        }
        
        .model-card.primary {
            border-color: hsl(var(--foreground));
            border: 2px solid hsl(var(--foreground));
        }
        
        .model-header {
            font-weight: 600;
            color: hsl(var(--foreground));
            margin-bottom: var(--space-2);
        }
        
        .model-spec {
            font-size: 0.8rem;
            color: hsl(var(--text-secondary));
            margin-bottom: var(--space-1);
        }
        
        .model-reason {
            font-size: 0.8rem;
            color: hsl(var(--foreground));
            margin-top: var(--space-2);
        }
        
        /* ========================================
           RESPONSIVE DESIGN
        ======================================== */
        
        @media (max-width: 768px) {
            body {
                padding: var(--space-2);
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }
            
            .presets-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .recommendations-sidebar {
                position: static;
                margin-bottom: var(--space-4);
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .presets-grid {
                grid-template-columns: 1fr;
            }
            
            .auto-mode-section {
                flex-direction: column;
                gap: var(--space-2);
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Windsurf Model Selector v9.0</h1>
            <p class="subtitle">Smart prompt enhancement for Windsurf IDE - Analyze your task, get optimal model recommendations, and enhance your prompts with AI</p>
        </header>
        
        <!-- Quick Presets Bar -->
        <div class="presets-bar">
            <button class="preset-btn" data-preset="debugging">
                <div class="preset-icon">üêõ</div>
                <div class="preset-name">Debugging</div>
                <div class="preset-desc">Code analysis and bug fixing</div>
            </button>
            <button class="preset-btn" data-preset="development">
                <div class="preset-icon">üíª</div>
                <div class="preset-name">Development</div>
                <div class="preset-desc">General coding tasks</div>
            </button>
            <button class="preset-btn" data-preset="design">
                <div class="preset-icon">üé®</div>
                <div class="preset-name">Design</div>
                <div class="preset-desc">UI/UX and styling</div>
            </button>
            <button class="preset-btn" data-preset="documentation">
                <div class="preset-icon">üìö</div>
                <div class="preset-name">Documentation</div>
                <div class="preset-desc">Writing and docs</div>
            </button>
            <button class="preset-btn" data-preset="planning">
                <div class="preset-icon">üìã</div>
                <div class="preset-name">Planning</div>
                <div class="preset-desc">Architecture and strategy</div>
            </button>
            <button class="preset-btn" data-preset="optimization">
                <div class="preset-icon">‚ö°</div>
                <div class="preset-name">Optimization</div>
                <div class="preset-desc">Performance tuning</div>
            </button>
        </div>

        <div class="grid grid-2">
            <!-- Main Content -->
            <div class="main-content">
                <!-- Task Analysis (no tabs) -->
                <div class="card">
                    <h2>Task Analysis</h2>
                    
                    <!-- Auto Mode Toggle -->
                    <div class="auto-mode-section">
                        <div>
                            <div class="auto-mode-title">ü§ñ Auto-Analysis Mode</div>
                            <div class="auto-mode-desc">AI will analyze your task and recommend the optimal model automatically</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoMode" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <!-- Budget Mode Toggle -->
                    <div class="auto-mode-section">
                        <div>
                            <div class="auto-mode-title">üí∞ Budget Mode</div>
                            <div class="auto-mode-desc">Prioritize free and low-cost models</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="budgetMode">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <!-- Input Section -->
                    <div class="input-section">
                        <label class="input-label" for="taskInput">
                            Describe your task:
                            <div class="history-dropdown">
                                <button class="history-toggle" id="historyToggle">üïí</button>
                                <div class="history-menu" id="historyMenu">
                                    <!-- History items will be populated here -->
                                    <div class="history-clear" id="clearHistory">Clear History</div>
                                </div>
                            </div>
                        </label>
                        <div class="input-wrapper">
                            <textarea id="taskInput" placeholder="Example: I need to debug a React component that's not rendering properly. The component should fetch user data from an API and display it in a table format."></textarea>
                            <button class="copy-btn" id="copyBtn" title="Copy to clipboard">üìã</button>
                        </div>
                        <div class="input-hint">üí° Be specific about your requirements for better model recommendations</div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: var(--space-3); margin-bottom: var(--space-4);">
                        <button class="btn btn-primary btn-full" id="analyzeBtn">
                            üîç Analyze Task
                        </button>
                        <button class="btn btn-outline" id="optimizeBtn">
                            ‚ú® Optimize
                        </button>
                        <button class="btn btn-secondary" id="clearBtn">
                            Clear
                        </button>
                    </div>

                    <!-- Analysis Progress Card -->
                    <div id="analysisProgress" class="analysis-progress">
                        <div class="progress-step" id="step1">
                            <div class="step-checkmark">1</div>
                            <div class="step-content">
                                <div class="step-title">üîç Extracting task features...</div>
                                <div class="step-details">
                                    <div id="detectedFeatures" class="feature-pills">
                                        <!-- Feature pills will be added here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress-step" id="step2">
                            <div class="step-checkmark">2</div>
                            <div class="step-content">
                                <div class="step-title">‚öñÔ∏è Scoring models...</div>
                                <div class="step-details">
                                    <div id="modelScores" class="model-scores">
                                        <!-- Model scores will be added here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress-step" id="step3">
                            <div class="step-checkmark">3</div>
                            <div class="step-content">
                                <div class="step-title">üéØ Ranking recommendations...</div>
                                <div class="step-details">
                                    <div id="rankingSlots" class="ranking-slots">
                                        <!-- Ranking slots will be added here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress-step" id="step4">
                            <div class="step-checkmark">4</div>
                            <div class="step-content">
                                <div class="step-title">‚úÖ Analysis complete</div>
                                <div class="step-details">Ready to show recommendations</div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="results" style="display: none;">
                        <h3>üéØ Recommended Model</h3>
                        <div id="recommendation" class="card" style="background: hsl(var(--accent)); border-color: hsl(var(--foreground));">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <div class="recommendations-sidebar">
                    <div class="sidebar-title">
                        üèÜ Top Models (Dec 2025)
                    </div>
                    <div id="compact-cards">
                        <!-- Recommendations will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // KODEXALABS WINDSURF MODEL SELECTOR v9.0
        // Smart Scoring Engine - December 2025
        // ========================================

        // ========================================
        // MODEL DATABASE - December 2025 Lineup
        // ========================================
        const models = [
            {
                id: "claude-opus-4.5",
                rank: 1,
                name: "Claude Opus 4.5",
                category: "premium",
                context: "200k",
                speed: "Medium",
                cost: "2x credits",
                costTier: 3,
                strengths: [
                    "architecture-planning",
                    "fuzzy-requirements",
                    "cross-repo-strategy",
                    "complex-reasoning",
                    "long-context",
                    "broad-guidance"
                ],
                description: "Most capable model in Windsurf. Best for fuzzy planning, architecture design, and cross-repo strategy. Currently at Sonnet pricing (2x) instead of 20x.",
                docsUrl: "https://docs.windsurf.com/windsurf/models",
                guideUrl: "https://windsurf.com/changelog",
                communityUrl: "https://www.reddit.com/r/windsurf/comments/1p5qcus/claude_opus_45_in_windsurf_for_2x_credits_instead/"
            },
            {
                id: "swe-1.5",
                rank: 2,
                name: "SWE-1.5",
                category: "workhorse",
                context: "128k",
                speed: "Ultra Fast (950 tok/s)",
                cost: "Standard",
                costTier: 2,
                strengths: [
                    "multi-file-refactor",
                    "deep-debugging",
                    "agentic-workflows",
                    "codebase-exploration",
                    "full-stack-apps",
                    "config-editing",
                    "flow-window-speed"
                ],
                description: "Cognition's flagship agentic model. Near Claude 4.5-level performance at 13x the speed. Kubernetes manifest edits in ~5s vs ~20s. Daily driver for Cognition engineers.",
                docsUrl: "https://docs.windsurf.com/windsurf/models",
                guideUrl: "https://cognition.ai/blog/swe-1-5",
                communityUrl: "https://www.reddit.com/r/windsurf/comments/1pcafy4/do_you_choose_opus45_or_swe15_sonnet45/"
            },
            {
                id: "gpt-5.1-codex-max",
                rank: 3,
                name: "GPT-5.1-Codex Max",
                category: "reasoning",
                context: "128k",
                speed: "Variable (Low/Med/High)",
                cost: "Low tier FREE",
                costTier: 2,
                strengths: [
                    "precise-algorithms",
                    "explicit-instructions",
                    "structured-tasks",
                    "reasoning-depth",
                    "code-generation",
                    "tight-scope"
                ],
                description: "OpenAI's agentic coding model with 3 reasoning tiers. Low tier is FREE for paid users (limited time). Best for precise algorithms and tightly scoped tasks with explicit instructions.",
                docsUrl: "https://docs.windsurf.com/windsurf/models",
                guideUrl: "https://windsurf.com/changelog",
                communityUrl: "https://www.reddit.com/r/windsurf/comments/1o9b5b8/gpt5_codex_vs_claude_sonnet_45/"
            },
            {
                id: "claude-3.7-sonnet-thinking",
                rank: 4,
                name: "Claude 3.7 Sonnet (Thinking)",
                category: "planning",
                context: "1M",
                speed: "Medium",
                cost: "1.5x credits",
                costTier: 2,
                strengths: [
                    "deep-reasoning",
                    "complex-tasks",
                    "architecture-planning",
                    "long-context",
                    "step-by-step",
                    "edge-cases"
                ],
                description: "Extended thinking mode for complex large tasks. 1M token context window. Best for deep reasoning, planning complex features, and handling edge cases systematically.",
                docsUrl: "https://docs.windsurf.com/windsurf/models",
                guideUrl: "https://windsurf.com/changelog",
                communityUrl: "https://www.reddit.com/r/windsurf/comments/1le42im/what_are_your_thoughts_on_swe1_for_planning_and/"
            },
            {
                id: "swe-1-lite",
                rank: 5,
                name: "SWE-1-lite",
                category: "free",
                context: "128k",
                speed: "Fast",
                cost: "FREE (unlimited)",
                costTier: 1,
                strengths: [
                    "budget-friendly",
                    "unlimited-use",
                    "general-coding",
                    "quick-tasks",
                    "learning",
                    "prototyping"
                ],
                description: "Replaced Cascade Base with far better quality. Unlimited free use for all plans. Best fallback for cost-sensitive workflows or when credits are low.",
                docsUrl: "https://docs.windsurf.com/windsurf/models",
                guideUrl: "https://windsurf.com/changelog",
                communityUrl: "https://www.reddit.com/r/windsurf/"
            }
        ];

        // ========================================
        // INTENT FEATURE EXTRACTION
        // ========================================
        function analyzeTaskFeatures(task) {
            const t = task.toLowerCase();
            
            // Feature detection with weighted keyword groups
            const features = {
                // Planning & Architecture
                planning: 0,
                architecture: 0,
                fuzzyRequirements: 0,
                crossRepo: 0,
                
                // Debugging & Fixing
                debugging: 0,
                errorFixing: 0,
                
                // Refactoring & Multi-file
                refactoring: 0,
                multiFile: 0,
                largeScope: 0,
                
                // Algorithms & Precision
                algorithmic: 0,
                preciseInstructions: 0,
                tightScope: 0,
                
                // Speed & Cost
                speedPriority: 0,
                costSensitive: 0,
                
                // Complexity
                complexTask: 0,
                simpleTask: 0,
                
                // Context needs
                longContext: 0,
                
                // Agentic workflows
                agenticWorkflow: 0
            };

            // Planning & Architecture keywords
            const planningKeywords = ['plan', 'architect', 'design', 'strategy', 'roadmap', 'structure', 'organize', 'layout', 'blueprint'];
            const architectureKeywords = ['architecture', 'system design', 'microservice', 'monolith', 'database schema', 'api design', 'infrastructure'];
            const fuzzyKeywords = ['not sure', 'maybe', 'could be', 'might', 'explore', 'brainstorm', 'ideas', 'suggestions', 'help me think', 'what if', 'how should'];
            const crossRepoKeywords = ['multiple repo', 'cross-repo', 'monorepo', 'workspace', 'several project', 'different codebases'];

            // Debugging keywords
            const debugKeywords = ['debug', 'bug', 'error', 'fix', 'broken', 'not working', 'crash', 'issue', 'problem', 'failing', 'exception', 'stack trace'];
            const errorKeywords = ['error', 'exception', 'undefined', 'null', 'type error', 'syntax error', 'runtime', 'compile'];

            // Refactoring keywords
            const refactorKeywords = ['refactor', 'restructure', 'reorganize', 'clean up', 'improve code', 'modernize', 'migrate', 'upgrade', 'rewrite'];
            const multiFileKeywords = ['multiple files', 'several files', 'across files', 'many components', 'entire codebase', 'whole project', 'all files'];
            const largeScopeKeywords = ['large', 'big', 'entire', 'whole', 'complete', 'full', 'comprehensive', 'end-to-end', 'full-stack'];

            // Algorithm keywords
            const algorithmKeywords = ['algorithm', 'optimize', 'performance', 'complexity', 'efficient', 'data structure', 'sort', 'search', 'graph', 'tree', 'dynamic programming'];
            const preciseKeywords = ['exactly', 'precisely', 'specific', 'strict', 'must', 'requirement', 'specification', 'follow this', 'according to'];
            const tightScopeKeywords = ['single file', 'one function', 'this method', 'just this', 'only', 'small change', 'quick fix'];

            // Speed & Cost keywords
            const speedKeywords = ['fast', 'quick', 'rapid', 'immediately', 'asap', 'urgent', 'speed'];
            const costKeywords = ['budget', 'cheap', 'free', 'save credits', 'cost', 'economical', 'affordable', 'credits'];

            // Complexity keywords
            const complexKeywords = ['complex', 'complicated', 'intricate', 'advanced', 'sophisticated', 'challenging', 'difficult'];
            const simpleKeywords = ['simple', 'basic', 'easy', 'straightforward', 'trivial', 'quick'];

            // Long context keywords
            const longContextKeywords = ['long file', 'large file', 'entire codebase', 'huge codebase', 'massive codebase', 'large codebase', 'many files', 'documentation', 'analyze all', 'whole codebase'];

            // Agentic workflow keywords
            const agenticKeywords = ['automate', 'workflow', 'pipeline', 'continuous', 'agent', 'autonomous', 'multi-step', 'chain'];

            // Score each feature category
            const scoreKeywords = (keywords, weight = 1) => {
                return keywords.filter(kw => t.includes(kw)).length * weight;
            };

            features.planning = scoreKeywords(planningKeywords, 2);
            features.architecture = scoreKeywords(architectureKeywords, 3);
            features.fuzzyRequirements = scoreKeywords(fuzzyKeywords, 2);
            features.crossRepo = scoreKeywords(crossRepoKeywords, 3);
            
            features.debugging = scoreKeywords(debugKeywords, 2);
            features.errorFixing = scoreKeywords(errorKeywords, 2);
            
            features.refactoring = scoreKeywords(refactorKeywords, 2);
            features.multiFile = scoreKeywords(multiFileKeywords, 3);
            features.largeScope = scoreKeywords(largeScopeKeywords, 2);
            
            features.algorithmic = scoreKeywords(algorithmKeywords, 3);
            features.preciseInstructions = scoreKeywords(preciseKeywords, 2);
            features.tightScope = scoreKeywords(tightScopeKeywords, 2);
            
            features.speedPriority = scoreKeywords(speedKeywords, 2);
            features.costSensitive = scoreKeywords(costKeywords, 3);
            
            features.complexTask = scoreKeywords(complexKeywords, 2);
            features.simpleTask = scoreKeywords(simpleKeywords, 1);
            
            features.longContext = scoreKeywords(longContextKeywords, 2);
            features.agenticWorkflow = scoreKeywords(agenticKeywords, 2);

            // Derive composite scores
            features.needsPlanning = features.planning + features.architecture + features.fuzzyRequirements + features.crossRepo;
            features.needsDebugging = features.debugging + features.errorFixing;
            features.needsRefactoring = features.refactoring + features.multiFile + features.largeScope + features.agenticWorkflow;
            features.needsPrecision = features.algorithmic + features.preciseInstructions + features.tightScope;
            features.needsBudget = features.costSensitive + features.simpleTask;

            return features;
        }

        // ========================================
        // MODEL SCORING ENGINE
        // ========================================
        function scoreModelForTask(model, features) {
            let score = 0;
            const strengths = model.strengths;

            // Claude Opus 4.5 scoring - best for planning & fuzzy requirements
            if (model.id === 'claude-opus-4.5') {
                score += features.needsPlanning * 5;
                score += features.fuzzyRequirements * 6;
                score += features.architecture * 5;
                score += features.crossRepo * 6;
                score += features.complexTask * 3;
                score += features.longContext * 3;
                // Penalty for simple/budget tasks
                score -= features.simpleTask * 2;
                score -= features.costSensitive * 3;
                score -= features.speedPriority * 2;
            }

            // SWE-1.5 scoring - best for debugging, refactoring, agentic workflows
            if (model.id === 'swe-1.5') {
                score += features.needsDebugging * 6;
                score += features.needsRefactoring * 6;
                score += features.multiFile * 5;
                score += features.agenticWorkflow * 6;
                score += features.largeScope * 4;
                score += features.speedPriority * 4; // Ultra fast!
                // Good general-purpose score
                score += 5; // Base bonus as daily driver
            }

            // GPT-5.1-Codex Max scoring - best for precise algorithms
            if (model.id === 'gpt-5.1-codex-max') {
                score += features.needsPrecision * 6;
                score += features.algorithmic * 5;
                score += features.preciseInstructions * 5;
                score += features.tightScope * 4;
                // Good for structured tasks
                score += features.complexTask * 2;
                // Free tier bonus for cost-sensitive
                score += features.costSensitive * 2;
            }

            // Claude 3.7 Sonnet (Thinking) scoring - deep reasoning
            if (model.id === 'claude-3.7-sonnet-thinking') {
                score += features.complexTask * 5;
                score += features.needsPlanning * 4;
                score += features.longContext * 5;
                score += features.architecture * 3;
                // Good for step-by-step reasoning
                score += features.needsPrecision * 2;
            }

            // SWE-1-lite scoring - budget fallback
            if (model.id === 'swe-1-lite') {
                score += features.needsBudget * 8;
                score += features.costSensitive * 6;
                score += features.simpleTask * 4;
                // Always viable as fallback
                score += 2;
            }

            // Cost tier adjustment
            if (features.costSensitive > 0) {
                score -= (model.costTier - 1) * 3;
            }

            return Math.max(0, score);
        }

        // ========================================
        // RANKED MODEL SELECTION
        // ========================================
        function getRankedModelsForTask(task) {
            const features = analyzeTaskFeatures(task);
            
            // Score all models with budget mode consideration
            const scoredModels = models.map(model => ({
                model: model,
                score: scoreModelForTaskWithBudget(model, features),
                features: features
            }));

            // Sort by score descending
            scoredModels.sort((a, b) => b.score - a.score);

            // Generate reasoning for primary choice
            const primary = scoredModels[0];
            const reasoning = generateReasoning(primary.model, features);

            return {
                primary: primary.model,
                fallbackB: scoredModels[1]?.model || null,
                fallbackC: scoredModels.find(s => s.model.costTier === 1)?.model || scoredModels[scoredModels.length - 1]?.model,
                reasoning: reasoning,
                features: features,
                allScored: scoredModels
            };
        }

        // ========================================
        // REASONING GENERATOR
        // ========================================
        function generateReasoning(model, features) {
            const reasons = [];

            if (model.id === 'claude-opus-4.5') {
                if (features.fuzzyRequirements > 0) reasons.push("fuzzy/exploratory requirements");
                if (features.architecture > 0) reasons.push("architecture design");
                if (features.crossRepo > 0) reasons.push("cross-repo strategy");
                if (features.needsPlanning > 0) reasons.push("planning and broad guidance");
            }

            if (model.id === 'swe-1.5') {
                if (features.needsDebugging > 0) reasons.push("deep debugging");
                if (features.needsRefactoring > 0) reasons.push("multi-file refactoring");
                if (features.agenticWorkflow > 0) reasons.push("agentic workflow");
                if (features.speedPriority > 0) reasons.push("speed priority (950 tok/s)");
                if (reasons.length === 0) reasons.push("general coding (daily driver)");
            }

            if (model.id === 'gpt-5.1-codex-max') {
                if (features.algorithmic > 0) reasons.push("algorithmic precision");
                if (features.preciseInstructions > 0) reasons.push("explicit structured instructions");
                if (features.tightScope > 0) reasons.push("tightly scoped task");
            }

            if (model.id === 'claude-3.7-sonnet-thinking') {
                if (features.complexTask > 0) reasons.push("complex reasoning required");
                if (features.longContext > 0) reasons.push("long context (1M tokens)");
                if (features.needsPlanning > 0) reasons.push("step-by-step planning");
            }

            if (model.id === 'swe-1-lite') {
                if (features.costSensitive > 0) reasons.push("cost-sensitive (FREE unlimited)");
                if (features.simpleTask > 0) reasons.push("simple/quick task");
                reasons.push("budget-friendly fallback");
            }

            return reasons.length > 0 
                ? `Recommended because your task involves ${reasons.slice(0, 3).join(', ')}.`
                : `Recommended as a strong general-purpose choice for this task.`;
        }

        // ========================================
        // LEGACY WRAPPER (for compatibility)
        // ========================================
        function analyzeTask(task) {
            const result = getRankedModelsForTask(task);
            // Return primary model for backward compatibility
            return result.primary;
        }

        // ========================================
        // ENHANCED RECOMMENDATION DISPLAY
        // ========================================
        function showRecommendationWithFallbacks(task) {
            const result = getRankedModelsForTask(task);
            const { primary, fallbackB, fallbackC, reasoning } = result;
            
            const results = document.getElementById('results');
            const recommendation = document.getElementById('recommendation');
            const budgetMode = document.getElementById('budgetMode').checked;

            // Build external links HTML
            const buildLinks = (model) => {
                let links = '';
                if (model.docsUrl) {
                    links += `<a href="${model.docsUrl}" target="_blank" rel="noopener" style="font-size: 0.75rem; color: hsl(var(--text-muted)); text-decoration: underline; margin-right: var(--space-2);">üìÑ Docs</a>`;
                }
                if (model.guideUrl) {
                    links += `<a href="${model.guideUrl}" target="_blank" rel="noopener" style="font-size: 0.75rem; color: hsl(var(--text-muted)); text-decoration: underline; margin-right: var(--space-2);">üìñ Guide</a>`;
                }
                if (model.communityUrl) {
                    links += `<a href="${model.communityUrl}" target="_blank" rel="noopener" style="font-size: 0.75rem; color: hsl(var(--text-muted)); text-decoration: underline;">üí¨ Reddit</a>`;
                }
                return links;
            };

            // Build fallback card HTML
            const buildFallbackCard = (model, label) => {
                if (!model) return '';
                return `
                    <div style="background: hsl(var(--secondary)); border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); padding: var(--space-3); cursor: pointer;" onclick="showModelDetails(models.find(m => m.id === '${model.id}'))">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-1);">
                            <span style="font-size: 0.7rem; color: hsl(var(--text-muted)); text-transform: uppercase; letter-spacing: 0.05em;">${label}</span>
                            <span style="font-size: 0.75rem; color: hsl(var(--text-secondary));">${model.cost}</span>
                        </div>
                        <div style="font-weight: 600; color: hsl(var(--foreground)); font-size: 0.9rem;">${model.name}</div>
                        <div style="font-size: 0.75rem; color: hsl(var(--text-secondary)); margin-top: var(--space-1);">${model.speed}</div>
                    </div>
                `;
            };

            recommendation.innerHTML = `
                <!-- Primary Recommendation -->
                <div style="margin-bottom: var(--space-4);">
                    <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-2);">
                        <div style="font-size: 1.5rem; font-weight: 800; color: hsl(var(--foreground)); background: hsl(var(--secondary)); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-md); border: 2px solid hsl(var(--foreground));">A</div>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-1);">
                                <h3 style="margin: 0; font-size: 1.1rem;">${primary.name}</h3>
                                ${budgetMode ? '<span class="status-indicator status-info" style="font-size: 0.7rem;">üí∞ Budget Mode Active</span>' : ''}
                            </div>
                            <span class="category-indicator category-${primary.category}">${primary.category}</span>
                        </div>
                    </div>
                    
                    <!-- Reasoning -->
                    <p style="margin-bottom: var(--space-3); color: hsl(var(--text-secondary)); font-size: 0.9rem; font-style: italic; border-left: 2px solid hsl(var(--border)); padding-left: var(--space-3);">
                        üí° ${reasoning}
                    </p>
                    
                    <p style="margin-bottom: var(--space-3); color: hsl(var(--text-secondary)); font-size: 0.85rem;">${primary.description}</p>
                    
                    <!-- Specs Grid -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2); margin-bottom: var(--space-3);">
                        <div style="text-align: center; padding: var(--space-2); background: hsl(var(--secondary)); border-radius: var(--radius-md);">
                            <div style="font-size: 0.75rem; color: hsl(var(--text-muted));">Context</div>
                            <div style="font-weight: 600; color: hsl(var(--foreground)); font-size: 0.9rem;">${primary.context}</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-2); background: hsl(var(--secondary)); border-radius: var(--radius-md);">
                            <div style="font-size: 0.75rem; color: hsl(var(--text-muted));">Speed</div>
                            <div style="font-weight: 600; color: hsl(var(--foreground)); font-size: 0.9rem;">${primary.speed}</div>
                        </div>
                        <div style="text-align: center; padding: var(--space-2); background: hsl(var(--secondary)); border-radius: var(--radius-md);">
                            <div style="font-size: 0.75rem; color: hsl(var(--text-muted));">Cost</div>
                            <div style="font-weight: 600; color: hsl(var(--foreground)); font-size: 0.9rem;">${primary.cost}</div>
                        </div>
                    </div>
                    
                    <!-- Strengths -->
                    <div style="margin-bottom: var(--space-3);">
                        <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: var(--space-2); color: hsl(var(--foreground));">Strengths:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-1);">
                            ${primary.strengths.slice(0, 5).map(strength => `
                                <span class="status-indicator status-success" style="font-size: 0.7rem;">${strength.replace(/-/g, ' ')}</span>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- External Links -->
                    <div style="margin-bottom: var(--space-3);">
                        ${buildLinks(primary)}
                    </div>
                    
                    <button class="btn btn-primary btn-full" onclick="selectModel('${primary.name}')">
                        Select ${primary.name}
                    </button>
                </div>
                
                <!-- Fallback Options -->
                <div style="border-top: 1px solid hsl(var(--border)); padding-top: var(--space-3);">
                    <div style="font-size: 0.8rem; font-weight: 600; color: hsl(var(--text-muted)); margin-bottom: var(--space-2); text-transform: uppercase; letter-spacing: 0.05em;">Alternative Options</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-2);">
                        ${buildFallbackCard(fallbackB, 'Fallback B')}
                        ${buildFallbackCard(fallbackC, 'Budget C')}
                    </div>
                </div>
            `;
            
            results.style.display = 'block';
        }

        // ========================================
        // LEGACY showRecommendation (for sidebar clicks)
        // ========================================
        function showRecommendation(model) {
            const results = document.getElementById('results');
            const recommendation = document.getElementById('recommendation');
            
            // Build external links HTML
            const buildLinks = (m) => {
                let links = '';
                if (m.docsUrl) {
                    links += `<a href="${m.docsUrl}" target="_blank" rel="noopener" style="font-size: 0.75rem; color: hsl(var(--text-muted)); text-decoration: underline; margin-right: var(--space-2);">üìÑ Docs</a>`;
                }
                if (m.guideUrl) {
                    links += `<a href="${m.guideUrl}" target="_blank" rel="noopener" style="font-size: 0.75rem; color: hsl(var(--text-muted)); text-decoration: underline; margin-right: var(--space-2);">üìñ Guide</a>`;
                }
                if (m.communityUrl) {
                    links += `<a href="${m.communityUrl}" target="_blank" rel="noopener" style="font-size: 0.75rem; color: hsl(var(--text-muted)); text-decoration: underline;">üí¨ Reddit</a>`;
                }
                return links;
            };
            
            // Build fallback card HTML
            const buildFallbackCard = (fallbackModel, label) => {
                if (!fallbackModel) return '';
                return `
                    <div style="background: hsl(var(--secondary)); border: 1px solid hsl(var(--border)); border-radius: var(--radius-md); padding: var(--space-3); cursor: pointer;" onclick="selectModel('${fallbackModel.name}')">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-1);">
                            <span style="font-size: 0.7rem; color: hsl(var(--text-muted)); text-transform: uppercase; letter-spacing: 0.05em;">${label}</span>
                            <span style="font-size: 0.75rem; color: hsl(var(--text-secondary));">${fallbackModel.cost}</span>
                        </div>
                        <div style="font-weight: 600; color: hsl(var(--foreground)); font-size: 0.9rem;">${fallbackModel.name}</div>
                        <div style="font-size: 0.75rem; color: hsl(var(--text-secondary)); margin-top: var(--space-1);">${fallbackModel.speed}</div>
                    </div>
                `;
            };

            recommendation.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-3);">
                    <div>
                        <div style="font-size: 1.1rem; font-weight: 600; color: hsl(var(--foreground)); margin-bottom: var(--space-1);">
                            ${model.name}
                        </div>
                        <div style="font-size: 0.9rem; color: hsl(var(--text-secondary)); margin-bottom: var(--space-2);">
                            ${model.description}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="category-indicator category-${model.category}" style="margin-bottom: var(--space-1);">
                            ${model.category.toUpperCase()}
                        </div>
                        <div style="font-size: 0.8rem; color: hsl(var(--text-muted));">
                            Rank #${model.rank}
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-2); margin-bottom: var(--space-3);">
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: hsl(var(--text-muted)); margin-bottom: 2px;">Context</div>
                        <div style="font-weight: 600; color: hsl(var(--foreground));">${model.context}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: hsl(var(--text-muted)); margin-bottom: 2px;">Speed</div>
                        <div style="font-weight: 600; color: hsl(var(--foreground));">${model.speed}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.8rem; color: hsl(var(--text-muted)); margin-bottom: 2px;">Cost</div>
                        <div style="font-weight: 600; color: hsl(var(--foreground));">${model.cost}</div>
                    </div>
                </div>
                
                <div style="margin-bottom: var(--space-3);">
                    <div style="font-size: 0.9rem; font-weight: 600; color: hsl(var(--foreground)); margin-bottom: var(--space-1);">
                        üí° Why this model?
                    </div>
                    <div style="font-size: 0.85rem; color: hsl(var(--text-secondary)); line-height: 1.4;">
                        ${generateReasoning(model, analyzeTaskFeatures(document.getElementById('taskInput').value))}
                    </div>
                </div>
                
                <div style="margin-bottom: var(--space-3);">
                    <div style="font-size: 0.9rem; font-weight: 600; color: hsl(var(--foreground)); margin-bottom: var(--space-2);">
                        üîÑ Alternative Options
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-2);">
                        ${buildFallbackCard(models.find(m => m.rank === 2), 'Fallback B')}
                        ${buildFallbackCard(models.find(m => m.costTier === 1), 'Budget C')}
                    </div>
                </div>
                
                <div style="display: flex; gap: var(--space-2); margin-bottom: var(--space-2);">
                    <button class="btn btn-outline" onclick="toggleComparison()" style="flex: 0 0 auto;">
                        ‚öñÔ∏è Compare Top 3
                    </button>
                    <button class="btn btn-outline" onclick="exportAsMarkdown()" style="flex: 0 0 auto;">
                        üìÑ Export
                    </button>
                    <button class="btn btn-primary" onclick="selectModel('${model.name}')" style="flex: 1;">
                        Select This Model
                    </button>
                </div>
            `;
            
            results.style.display = 'block';
        }
        
        // ========================================
        // PROMPT OPTIMIZATION ENGINE
        // ========================================
        
        class PromptOptimizer {
            static optimize(text) {
                let optimized = text;
                
                // Add @CascadeProjects tag if files/repo mentioned
                if (/\b(file|files|repo|repository|directory|folder|d:\\|\\dev\\)/i.test(optimized)) {
                    optimized = '@CascadeProjects\n\n' + optimized;
                }
                
                // Convert vague phrases to specific instructions
                const replacements = [
                    { from: /update\s+the\s+models/gi, to: 'Update the models array in d:\\dev\\CascadeProjects\\windsurf-model-selector\\index.html' },
                    { from: /make\s+sure\s+they're\s+current/gi, to: 'to reflect December 2025 Windsurf model availability' },
                    { from: /fix\s+the\s+bug/gi, to: 'Debug and fix the issue in' },
                    { from: /add\s+the\s+feature/gi, to: 'Implement the new feature in' },
                    { from: /check\s+if\s+it\s+works/gi, to: 'Verify the implementation works correctly and test all functionality' },
                    { from: /deploy\s+it/gi, to: 'Deploy to GitHub Pages when complete' }
                ];
                
                replacements.forEach(({ from, to }) => {
                    optimized = optimized.replace(from, to);
                });
                
                // Break long sentences into numbered steps
                if (optimized.length > 100 && !/\d+\./.test(optimized)) {
                    const sentences = optimized.split(/[.!?]+/).filter(s => s.trim());
                    if (sentences.length > 2) {
                        optimized = sentences.map((s, i) => `${i + 1}. ${s.trim()}`).join('\n');
                    }
                }
                
                // Add constraints if not present
                if (!/DO NOT|do not/gi.test(optimized) && /change|modify|update|edit/gi.test(optimized)) {
                    optimized += '\n\nDo NOT change the core scoring engine logic or UI layout unless explicitly requested.';
                }
                
                // Add validation for deployment changes
                if (/deploy|push|commit/gi.test(optimized) && !/confirm|verify|test/gi.test(optimized)) {
                    optimized += '\n\nTest locally before deploying and verify all functionality works.';
                }
                
                return optimized;
            }
        }
        
        // ========================================
        // ANIMATED ANALYSIS ORCHESTRATOR
        // ========================================
        
        class AnalysisOrchestrator {
            static async analyzeWithAnimation(task) {
                const analyzeBtn = document.getElementById('analyzeBtn');
                const progressCard = document.getElementById('analysisProgress');
                const results = document.getElementById('results');
                
                // Disable button and show progress
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'üîÑ Analyzing...';
                results.style.display = 'none';
                progressCard.classList.add('active');
                
                // Clear previous progress
                this.clearProgress();
                
                try {
                    // Step 1: Extract features (400ms)
                    await this.animateStep(1, 'active');
                    const features = analyzeTaskFeatures(task);
                    this.displayFeatures(features);
                    await this.delay(400);
                    this.completeStep(1);
                    
                    // Step 2: Score models (800ms)
                    await this.animateStep(2, 'active');
                    const scoredModels = this.scoreAllModels(task, features);
                    this.displayScores(scoredModels);
                    await this.delay(800);
                    this.completeStep(2);
                    
                    // Step 3: Rank recommendations (500ms)
                    await this.animateStep(3, 'active');
                    const ranked = getRankedModelsForTask(task);
                    this.displayRanking(ranked);
                    await this.delay(500);
                    this.completeStep(3);
                    
                    // Step 4: Complete (300ms)
                    await this.animateStep(4, 'active');
                    await this.delay(300);
                    this.completeStep(4);
                    
                    // Show final results
                    await this.delay(200);
                    progressCard.classList.remove('active');
                    showRecommendationWithFallbacks(task);
                    
                    // Add to history
                    StorageManager.addToHistory(task);
                    updateHistoryDropdown();
                    
                } catch (error) {
                    console.error('Analysis error:', error);
                    showToast('‚ùå Analysis failed. Please try again.');
                } finally {
                    // Reset button
                    analyzeBtn.disabled = false;
                    analyzeBtn.textContent = 'üîç Analyze Task';
                }
            }
            
            static clearProgress() {
                document.getElementById('detectedFeatures').innerHTML = '';
                document.getElementById('modelScores').innerHTML = '';
                document.getElementById('rankingSlots').innerHTML = '';
                
                for (let i = 1; i <= 4; i++) {
                    const step = document.getElementById(`step${i}`);
                    step.classList.remove('active', 'complete');
                    const checkmark = step.querySelector('.step-checkmark');
                    checkmark.textContent = i;
                }
            }
            
            static animateStep(stepNum, state) {
                return new Promise(resolve => {
                    const step = document.getElementById(`step${stepNum}`);
                    step.classList.add(state);
                    resolve();
                });
            }
            
            static completeStep(stepNum) {
                const step = document.getElementById(`step${stepNum}`);
                step.classList.remove('active');
                step.classList.add('complete');
                const checkmark = step.querySelector('.step-checkmark');
                checkmark.textContent = '‚úÖ';
            }
            
            static displayFeatures(features) {
                const container = document.getElementById('detectedFeatures');
                const activeFeatures = Object.entries(features)
                    .filter(([key, value]) => value > 0)
                    .map(([key]) => key);
                
                activeFeatures.forEach((feature, index) => {
                    setTimeout(() => {
                        const pill = document.createElement('div');
                        pill.className = 'feature-pill';
                        pill.textContent = feature.replace(/([A-Z])/g, ' $1').trim();
                        pill.style.animationDelay = `${index * 50}ms`;
                        container.appendChild(pill);
                    }, index * 100);
                });
            }
            
            static scoreAllModels(task, features) {
                return models.map(model => ({
                    model,
                    score: scoreModelForTaskWithBudget(model, features)
                })).sort((a, b) => b.score - a.score);
            }
            
            static displayScores(scoredModels) {
                const container = document.getElementById('modelScores');
                
                scoredModels.forEach((item, index) => {
                    setTimeout(() => {
                        const scoreDiv = document.createElement('div');
                        scoreDiv.className = 'model-score';
                        scoreDiv.style.animationDelay = `${index * 100}ms`;
                        
                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'model-name';
                        nameSpan.textContent = item.model.name;
                        
                        const scoreSpan = document.createElement('span');
                        scoreSpan.className = 'score-value';
                        scoreSpan.textContent = `${item.score} pts`;
                        
                        scoreDiv.appendChild(nameSpan);
                        scoreDiv.appendChild(scoreSpan);
                        container.appendChild(scoreDiv);
                        
                        // Animate score counting
                        this.animateScore(scoreSpan, item.score);
                    }, index * 150);
                });
            }
            
            static animateScore(element, targetScore) {
                let currentScore = 0;
                const increment = targetScore / 20;
                const timer = setInterval(() => {
                    currentScore += increment;
                    if (currentScore >= targetScore) {
                        currentScore = targetScore;
                        clearInterval(timer);
                    }
                    element.textContent = `${Math.round(currentScore)} pts`;
                }, 15);
            }
            
            static displayRanking(ranked) {
                const container = document.getElementById('rankingSlots');
                const labels = ['Primary A', 'Fallback B', 'Budget C'];
                
                [ranked.primary, ranked.fallbackB, ranked.fallbackC].forEach((model, index) => {
                    setTimeout(() => {
                        const slot = document.createElement('div');
                        slot.className = 'rank-slot';
                        slot.style.animationDelay = `${index * 100}ms`;
                        
                        const labelDiv = document.createElement('div');
                        labelDiv.className = 'rank-label';
                        labelDiv.textContent = labels[index];
                        
                        const modelDiv = document.createElement('div');
                        modelDiv.className = 'rank-model';
                        modelDiv.textContent = model.name;
                        
                        slot.appendChild(labelDiv);
                        slot.appendChild(modelDiv);
                        container.appendChild(slot);
                    }, index * 150);
                });
            }
            
            static delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // ========================================
        // TOAST NOTIFICATIONS
        // ========================================
        
        function showToast(message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // ========================================
        // HISTORY DROPDOWN
        // ========================================
        
        function updateHistoryDropdown() {
            const menu = document.getElementById('historyMenu');
            const history = StorageManager.getHistory();
            
            // Clear existing items (except clear button)
            const items = menu.querySelectorAll('.history-item');
            items.forEach(item => item.remove());
            
            // Add history items
            history.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div class="history-text">${entry.text}</div>
                    <div class="history-time">${new Date(entry.timestamp).toLocaleTimeString()}</div>
                `;
                item.addEventListener('click', () => {
                    document.getElementById('taskInput').value = entry.fullText;
                    menu.classList.remove('show');
                });
                
                menu.insertBefore(item, menu.lastElementChild);
            });
        }
        
        // ========================================
        // ENHANCED SCORING WITH BUDGET MODE
        // ========================================
        
        function scoreModelForTaskWithBudget(model, features) {
            const baseScore = scoreModelForTask(model, features);
            const budgetMode = document.getElementById('budgetMode').checked;
            
            if (!budgetMode) return baseScore;
            
            // Apply budget mode modifiers
            let finalScore = baseScore;
            switch (model.costTier) {
                case 1: 
                    finalScore = baseScore + 10;  // Free models get +10
                    break;
                case 2: 
                    finalScore = baseScore + 5;   // Low cost get +5
                    break;
                case 3: 
                    finalScore = baseScore - 5;   // Premium get -5
                    break;
            }
            
            // Temporary: Log budget mode scoring for testing
            console.log(`Budget Mode: ${model.name} (${model.costTier}) - Base: ${baseScore} ‚Üí Final: ${finalScore}`);
            
            return finalScore;
        }
        
        // ========================================
        // COPY TO CLIPBOARD
        // ========================================
        
        async function copyToClipboard() {
            const textarea = document.getElementById('taskInput');
            const copyBtn = document.getElementById('copyBtn');
            
            try {
                await navigator.clipboard.writeText(textarea.value);
                copyBtn.classList.add('copied');
                copyBtn.textContent = '‚úÖ';
                
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyBtn.textContent = 'üìã';
                }, 2000);
                
                showToast('‚úÖ Copied to clipboard');
            } catch (error) {
                showToast('‚ùå Failed to copy');
            }
        }
        
        // ========================================
        // MODEL COMPARISON
        // ========================================
        
        function toggleComparison() {
            const comparisonTable = document.getElementById('comparisonTable');
            if (!comparisonTable) {
                createComparisonTable();
            }
            
            const isVisible = comparisonTable.classList.contains('show');
            comparisonTable.classList.toggle('show', !isVisible);
        }
        
        function createComparisonTable() {
            const results = document.getElementById('results');
            const table = document.createElement('div');
            table.id = 'comparisonTable';
            table.className = 'comparison-table';
            
            const task = document.getElementById('taskInput').value;
            const ranked = getRankedModelsForTask(task);
            
            table.innerHTML = `
                <div class="comparison-title">‚öñÔ∏è Model Comparison</div>
                <div class="comparison-grid">
                    ${createModelCard(ranked.primary, 'Primary (A)', true)}
                    ${createModelCard(ranked.fallbackB, 'Fallback (B)', false)}
                    ${createModelCard(ranked.fallbackC, 'Budget (C)', false)}
                </div>
                <button class="btn btn-secondary" style="margin-top: var(--space-3);" onclick="toggleComparison()">Hide Comparison</button>
            `;
            
            results.appendChild(table);
        }
        
        function createModelCard(model, label, isPrimary) {
            const cardClass = isPrimary ? 'model-card primary' : 'model-card';
            return `
                <div class="${cardClass}">
                    <div class="model-header">${label}: ${model.name}</div>
                    <div class="model-spec">Context: ${model.context}</div>
                    <div class="model-spec">Speed: ${model.speed}</div>
                    <div class="model-spec">Cost: ${model.cost}</div>
                    <div class="model-reason">${generateReasoning(model, analyzeTaskFeatures(document.getElementById('taskInput').value))}</div>
                </div>
            `;
        }
        
        // ========================================
        // EXPORT AS MARKDOWN
        // ========================================
        
        function exportAsMarkdown() {
            try {
                const task = document.getElementById('taskInput').value;
                const ranked = getRankedModelsForTask(task);
                const features = analyzeTaskFeatures(task);
                const timestamp = new Date().toISOString();
                
                const markdown = `# Windsurf Model Recommendation
**Date:** ${new Date(timestamp).toLocaleString()}

## Task
${task}

## Recommended Model
**Primary (A):** ${ranked.primary.name}

**Reasoning:** ${generateReasoning(ranked.primary, features)}

**Context:** ${ranked.primary.context}

**Speed:** ${ranked.primary.speed}

**Cost:** ${ranked.primary.cost}

## Fallback Options
- **B:** ${ranked.fallbackB.name} - ${generateReasoning(ranked.fallbackB, features)}
- **C:** ${ranked.fallbackC.name} - ${generateReasoning(ranked.fallbackC, features)}

## Detected Features
${Object.entries(features).filter(([k, v]) => v > 0).map(([k]) => `- ${k}`).join('\n')}
`;
                
                // Check for Blob support
                if (typeof Blob === 'undefined') {
                    throw new Error('Blob API not supported in this browser');
                }
                
                const blob = new Blob([markdown], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `windsurf-recommendation-${timestamp.replace(/[:.]/g, '-')}.md`;
                a.click();
                URL.revokeObjectURL(url);
                
                showToast('üìÑ Exported as Markdown');
            } catch (error) {
                console.error('Export failed:', error);
                showToast('‚ùå Export failed. Try a different browser.');
                
                // Fallback: copy to clipboard
                try {
                    const task = document.getElementById('taskInput').value;
                    const ranked = getRankedModelsForTask(task);
                    const features = analyzeTaskFeatures(task);
                    const timestamp = new Date().toISOString();
                    
                    const markdown = `# Windsurf Model Recommendation
**Date:** ${new Date(timestamp).toLocaleString()}

## Task
${task}

## Primary Model: ${ranked.primary.name}
${generateReasoning(ranked.primary, features)}

## Features: ${Object.entries(features).filter(([k, v]) => v > 0).map(([k]) => k).join(', ')}`;
                    
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(markdown);
                        showToast('üìã Copied to clipboard instead');
                    }
                } catch (fallbackError) {
                    showToast('‚ùå Export and clipboard failed');
                }
            }
        }
        
        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize existing features
            initializePresets();
            populateRecommendations();
            
            // Restore budget mode state
            const budgetMode = StorageManager.get('windsurfSelector_budgetMode', false);
            document.getElementById('budgetMode').checked = budgetMode;
            
            // Initialize history dropdown
            updateHistoryDropdown();
            
            // Enhanced analyzer with animation
            initializeAnalyzerV9();
            
            // Initialize new features
            initializeOptimizeButton();
            initializeCopyButton();
            initializeHistoryDropdown();
            initializeBudgetMode();
        });
        
        function initializeAnalyzerV9() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const clearBtn = document.getElementById('clearBtn');
            const taskInput = document.getElementById('taskInput');
            
            analyzeBtn.addEventListener('click', () => {
                const task = taskInput.value.trim();
                if (!task) {
                    showToast('Please describe your task first.');
                    return;
                }
                AnalysisOrchestrator.analyzeWithAnimation(task);
            });
            
            clearBtn.addEventListener('click', () => {
                taskInput.value = '';
                document.getElementById('results').style.display = 'none';
                document.getElementById('analysisProgress').classList.remove('active');
            });
        }
        
        function initializeOptimizeButton() {
            const optimizeBtn = document.getElementById('optimizeBtn');
            const taskInput = document.getElementById('taskInput');
            
            optimizeBtn.addEventListener('click', () => {
                const currentText = taskInput.value;
                if (!currentText.trim()) {
                    showToast('Please enter a task to optimize.');
                    return;
                }
                
                // Show loading state
                const originalText = optimizeBtn.textContent;
                optimizeBtn.disabled = true;
                optimizeBtn.textContent = '‚è≥ Optimizing...';
                
                // Use setTimeout to allow UI to update before processing
                setTimeout(() => {
                    try {
                        const optimized = PromptOptimizer.optimize(currentText);
                        taskInput.value = optimized;
                        
                        // Highlight animation
                        taskInput.style.animation = 'pulse 0.5s';
                        setTimeout(() => {
                            taskInput.style.animation = '';
                        }, 500);
                        
                        showToast('‚úÖ Prompt optimized for Windsurf');
                    } catch (error) {
                        console.error('Optimization failed:', error);
                        showToast('‚ùå Optimization failed');
                    } finally {
                        // Reset button
                        optimizeBtn.disabled = false;
                        optimizeBtn.textContent = originalText;
                    }
                }, 100);
            });
        }
        
        function initializeCopyButton() {
            const copyBtn = document.getElementById('copyBtn');
            copyBtn.addEventListener('click', copyToClipboard);
        }
        
        function initializeHistoryDropdown() {
            const toggle = document.getElementById('historyToggle');
            const menu = document.getElementById('historyMenu');
            const clearBtn = document.getElementById('clearHistory');
            
            toggle.addEventListener('click', (e) => {
                e.stopPropagation();
                menu.classList.toggle('show');
            });
            
            clearBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                StorageManager.clearHistory();
                updateHistoryDropdown();
                showToast('History cleared');
            });
            
            // Close dropdown when clicking outside (supports both mouse and touch)
            const closeDropdown = (e) => {
                if (!e.target.closest('.history-dropdown')) {
                    menu.classList.remove('show');
                }
            };
            
            document.addEventListener('click', closeDropdown);
            document.addEventListener('touchstart', closeDropdown);
            
            // Prevent touch events on menu from bubbling up
            menu.addEventListener('touchstart', (e) => {
                e.stopPropagation();
            });
        }
        
        function initializeBudgetMode() {
            const budgetToggle = document.getElementById('budgetMode');
            budgetToggle.addEventListener('change', () => {
                StorageManager.set('windsurfSelector_budgetMode', budgetToggle.checked);
            });
        }
        
        // Add pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0%, 100% { background-color: hsl(var(--input)); }
                50% { background-color: hsl(var(--accent)); }
            }
        `;
        document.head.appendChild(style);

        // Preset functionality
        function initializePresets() {
            const presetBtns = document.querySelectorAll('.preset-btn');
            
            presetBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const preset = btn.dataset.preset;
                    
                    presetBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const taskInput = document.getElementById('taskInput');
                    const presetTexts = {
                        debugging: "I need to debug a complex issue across multiple files. There's an error in my application that involves async state management and I can't figure out the root cause.",
                        development: "I need help building a full-stack feature with React frontend and Node.js backend. This involves creating new API endpoints and UI components.",
                        design: "I need help with UI/UX design. I want to improve the user interface with better component architecture and styling patterns.",
                        documentation: "I need to write comprehensive documentation for our API. Please help me create clear and thorough docs with examples.",
                        planning: "I need to plan and architect a new microservices system. Help me design the overall structure, data flow, and service boundaries.",
                        optimization: "I need to optimize performance across our codebase. Help me identify bottlenecks and implement efficient algorithms."
                    };
                    
                    taskInput.value = presetTexts[preset] || '';
                });
            });
        }

        // Populate recommendations sidebar
        function populateRecommendations() {
            const container = document.getElementById('compact-cards');
            
            models.forEach(model => {
                const card = document.createElement('div');
                card.className = 'compact-card';
                card.innerHTML = `
                    <div class="compact-header">
                        <div class="compact-rank">${model.rank}</div>
                        <div class="compact-name">${model.name}</div>
                    </div>
                    <div class="compact-category category-${model.category}">${model.category}</div>
                    <div class="compact-specs">
                        <div class="compact-spec">
                            <strong>Context:</strong> ${model.context}
                        </div>
                        <div class="compact-spec">
                            <strong>Speed:</strong> ${model.speed}
                        </div>
                        <div class="compact-spec">
                            <strong>Cost:</strong> ${model.cost}
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    showModelDetails(model);
                });
                
                container.appendChild(card);
            });
        }

        // Initialize analyzer with smart scoring
        function initializeAnalyzer() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const clearBtn = document.getElementById('clearBtn');
            const taskInput = document.getElementById('taskInput');
            const results = document.getElementById('results');

            analyzeBtn.addEventListener('click', () => {
                const task = taskInput.value.trim();
                
                if (!task) {
                    alert('Please describe your task first.');
                    return;
                }

                analyzeBtn.textContent = 'üîÑ Analyzing...';
                analyzeBtn.disabled = true;

                setTimeout(() => {
                    // Use enhanced recommendation with fallbacks
                    showRecommendationWithFallbacks(task);
                    
                    analyzeBtn.textContent = 'üîç Analyze Task';
                    analyzeBtn.disabled = false;
                }, 800);
            });

            clearBtn.addEventListener('click', () => {
                taskInput.value = '';
                results.style.display = 'none';
            });
        }

        // Show model details (from sidebar click)
        function showModelDetails(model) {
            showRecommendation(model);
            
            const taskInput = document.getElementById('taskInput');
            taskInput.value = `I need help with a task that would benefit from ${model.name}'s capabilities: ${model.description.toLowerCase()}`;
        }

        // Select model
        function selectModel(modelName) {
            alert(`Model "${modelName}" has been selected for your Windsurf IDE session.\n\nIn the actual Windsurf IDE, this would switch your active model.`);
        }
    </script>
</body>
</html>
